---
description: åœ¨Macä¸Šæ‰“åŒ….NET Windowsæ¡Œé¢åº”ç”¨ç¨‹åºçš„å®Œæ•´æŒ‡å—å’Œæœ€ä½³å®è·µ
---

# Macä¸Šæ‰“åŒ….NET Windowsæ¡Œé¢åº”ç”¨ç¨‹åºæŒ‡å—

## é¡¹ç›®æ¦‚è¿°
æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªC#.NET 8.0 WPFæ¡Œé¢åº”ç”¨ç¨‹åº - è£…ç”²è½¦è¾†æŠ—æ¯ä¼¤æ•°å­—åŒ–è¯„ä¼°è½¯ä»¶å¹³å°ï¼Œéœ€è¦åœ¨Macå¼€å‘ç¯å¢ƒä¸‹æ‰“åŒ…æˆWindowså¯æ‰§è¡Œç¨‹åºã€‚

## æ ¸å¿ƒæ‰“åŒ…å‘½ä»¤

### 1. åŸºæœ¬å‘å¸ƒå‘½ä»¤
```bash
# å‘å¸ƒä¸ºè‡ªåŒ…å«åº”ç”¨ç¨‹åº (æ¨è)
dotnet publish src/ArmorVehicleDamageAssessment.UI \
  -c Release \
  -r win-x64 \
  --self-contained true \
  -p:PublishSingleFile=true \
  -p:IncludeNativeLibrariesForSelfExtract=true \
  -o ./publish/win-x64

# å‘å¸ƒä¸ºä¾èµ–æ¡†æ¶çš„åº”ç”¨ç¨‹åº (ä½“ç§¯æ›´å°)
dotnet publish src/ArmorVehicleDamageAssessment.UI \
  -c Release \
  -r win-x64 \
  --self-contained false \
  -o ./publish/win-x64-framework-dependent
```

### 2. ä¼˜åŒ–å‘å¸ƒé€‰é¡¹
```bash
# å¸¦ä»£ç è£å‰ªçš„å‘å¸ƒ (å‡å°ä½“ç§¯)
dotnet publish src/ArmorVehicleDamageAssessment.UI \
  -c Release \
  -r win-x64 \
  --self-contained true \
  -p:PublishSingleFile=true \
  -p:PublishTrimmed=true \
  -p:TrimMode=link \
  -p:IncludeNativeLibrariesForSelfExtract=true \
  -o ./publish/win-x64-trimmed
```

## é¡¹ç›®æ–‡ä»¶é…ç½®ä¼˜åŒ–

### åœ¨ [ArmorVehicleDamageAssessment.UI.csproj](mdc:src/ArmorVehicleDamageAssessment.UI/ArmorVehicleDamageAssessment.UI.csproj) ä¸­æ·»åŠ å‘å¸ƒé…ç½®ï¼š

```xml
<PropertyGroup Condition="'$(Configuration)' == 'Release'">
  <!-- å‘å¸ƒä¼˜åŒ– -->
  <DebugType>none</DebugType>
  <DebugSymbols>false</DebugSymbols>
  <Optimize>true</Optimize>
  
  <!-- å•æ–‡ä»¶å‘å¸ƒé…ç½® -->
  <PublishSingleFile>true</PublishSingleFile>
  <SelfContained>true</SelfContained>
  <RuntimeIdentifier>win-x64</RuntimeIdentifier>
  <IncludeNativeLibrariesForSelfExtract>true</IncludeNativeLibrariesForSelfExtract>
  
  <!-- ä»£ç è£å‰ªé…ç½® -->
  <PublishTrimmed>true</PublishTrimmed>
  <TrimMode>link</TrimMode>
  
  <!-- ç¨‹åºé›†å…ƒæ•°æ® -->
  <ApplicationIcon>Resources\icon.ico</ApplicationIcon>
  <Win32Resource>Resources\app.res</Win32Resource>
</PropertyGroup>
```

## æ”¯æŒçš„è¿è¡Œæ—¶æ ‡è¯†ç¬¦ (RID)

```bash
# Windowså¹³å°
win-x64        # Windows 64ä½ (æ¨è)
win-x86        # Windows 32ä½
win-arm64      # Windows ARM64

# å…¶ä»–å¹³å° (å¦‚éœ€è¦)
linux-x64      # Linux 64ä½
osx-x64        # macOS Intel
osx-arm64      # macOS Apple Silicon
```

## åˆ›å»ºå®‰è£…ç¨‹åº

### 1. ä½¿ç”¨ Wix Toolset (æ¨è)
```bash
# å®‰è£… Wix æ‰©å±•
dotnet add package WixSharp

# æˆ–è€…ä½¿ç”¨ä¼ ç»Ÿçš„ WiX Toolset v3/v4
# éœ€è¦åœ¨Windowsç¯å¢ƒæˆ–è™šæ‹Ÿæœºä¸­è¿è¡Œ
```

### 2. ä½¿ç”¨ Inno Setup
```bash
# åˆ›å»º Inno Setup è„šæœ¬æ–‡ä»¶
# éœ€è¦åœ¨Windowsç¯å¢ƒä¸­è¿è¡Œ Inno Setup Compiler
```

### 3. ä½¿ç”¨ NSIS (Nullsoft Scriptable Install System)
```bash
# è·¨å¹³å°è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨Macä¸Šä½¿ç”¨
brew install makensis

# åˆ›å»º .nsi è„šæœ¬æ–‡ä»¶
```

## å‘å¸ƒå‰æ£€æŸ¥æ¸…å•

### 1. é¡¹ç›®é…ç½®æ£€æŸ¥
- [ ] æ£€æŸ¥ [appsettings.json](mdc:src/ArmorVehicleDamageAssessment.UI/appsettings.json) é…ç½®
- [ ] éªŒè¯ [NLog.config](mdc:src/ArmorVehicleDamageAssessment.UI/NLog.config) æ—¥å¿—é…ç½®
- [ ] ç¡®è®¤æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²é€‚ç”¨äºéƒ¨ç½²ç¯å¢ƒ
- [ ] æ£€æŸ¥æ‰€æœ‰èµ„æºæ–‡ä»¶è·¯å¾„

### 2. ä¾èµ–é¡¹æ£€æŸ¥
```bash
# æ£€æŸ¥é¡¹ç›®ä¾èµ–
dotnet list src/ArmorVehicleDamageAssessment.UI package

# ç¡®è®¤æ‰€æœ‰NuGetåŒ…å…¼å®¹ç›®æ ‡å¹³å°
dotnet restore src/ArmorVehicleDamageAssessment.UI
```

### 3. æ„å»ºéªŒè¯
```bash
# åœ¨å‘å¸ƒå‰è¿›è¡Œå®Œæ•´æ„å»ºæµ‹è¯•
dotnet build src/ArmorVehicleDamageAssessment.UI -c Release

# è¿è¡Œæµ‹è¯• (å¦‚æœå­˜åœ¨)
dotnet test
```

## å‘å¸ƒè„šæœ¬æ¨¡æ¿

### publish.sh (Mac/Linux)
```bash
#!/bin/bash
set -e

echo "ğŸš€ å¼€å§‹å‘å¸ƒè£…ç”²è½¦è¾†æŠ—æ¯ä¼¤æ•°å­—åŒ–è¯„ä¼°è½¯ä»¶å¹³å°..."

# æ¸…ç†ä¹‹å‰çš„å‘å¸ƒ
rm -rf ./publish

# åˆ›å»ºå‘å¸ƒç›®å½•
mkdir -p ./publish

# å‘å¸ƒWindows x64ç‰ˆæœ¬
echo "ğŸ“¦ æ­£åœ¨å‘å¸ƒ Windows x64 ç‰ˆæœ¬..."
dotnet publish src/ArmorVehicleDamageAssessment.UI \
  -c Release \
  -r win-x64 \
  --self-contained true \
  -p:PublishSingleFile=true \
  -p:IncludeNativeLibrariesForSelfExtract=true \
  -o ./publish/win-x64

# å¤åˆ¶æ•°æ®åº“æ–‡ä»¶
cp database/init.sql ./publish/win-x64/

# åˆ›å»ºå‹ç¼©åŒ…
cd ./publish
zip -r ArmorVehicleDamageAssessment-win-x64-v1.0.0.zip win-x64/
cd ..

echo "âœ… å‘å¸ƒå®Œæˆï¼"
echo "ğŸ“ å‘å¸ƒæ–‡ä»¶ä½ç½®: ./publish/"
echo "ğŸ“¦ å®‰è£…åŒ…: ./publish/ArmorVehicleDamageAssessment-win-x64-v1.0.0.zip"
```

### publish.bat (Windows)
```batch
@echo off
echo ğŸš€ å¼€å§‹å‘å¸ƒè£…ç”²è½¦è¾†æŠ—æ¯ä¼¤æ•°å­—åŒ–è¯„ä¼°è½¯ä»¶å¹³å°...

REM æ¸…ç†ä¹‹å‰çš„å‘å¸ƒ
if exist publish rmdir /s /q publish

REM åˆ›å»ºå‘å¸ƒç›®å½•
mkdir publish

REM å‘å¸ƒWindows x64ç‰ˆæœ¬
echo ğŸ“¦ æ­£åœ¨å‘å¸ƒ Windows x64 ç‰ˆæœ¬...
dotnet publish src/ArmorVehicleDamageAssessment.UI ^
  -c Release ^
  -r win-x64 ^
  --self-contained true ^
  -p:PublishSingleFile=true ^
  -p:IncludeNativeLibrariesForSelfExtract=true ^
  -o ./publish/win-x64

REM å¤åˆ¶æ•°æ®åº“æ–‡ä»¶
copy database\init.sql .\publish\win-x64\

echo âœ… å‘å¸ƒå®Œæˆï¼
echo ğŸ“ å‘å¸ƒæ–‡ä»¶ä½ç½®: .\publish\
pause
```

## å¸¸è§é—®é¢˜è§£å†³

### 1. SQLite æ•°æ®åº“æ–‡ä»¶æ‰“åŒ…
```xml
<!-- åœ¨é¡¹ç›®æ–‡ä»¶ä¸­ç¡®ä¿SQLiteæ–‡ä»¶è¢«åŒ…å« -->
<ItemGroup>
  <None Update="ArmorVehicleDatabase.db">
    <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
  </None>
</ItemGroup>
```

### 2. WPFèµ„æºæ–‡ä»¶å¤„ç†
```xml
<!-- ç¡®ä¿å›¾æ ‡å’Œèµ„æºæ–‡ä»¶æ­£ç¡®æ‰“åŒ… -->
<ItemGroup>
  <Resource Include="Resources\**\*" />
  <None Update="icon.ico">
    <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
  </None>
</ItemGroup>
```

### 3. å­—ä½“æ–‡ä»¶åŒ…å«
```xml
<!-- å¦‚æœä½¿ç”¨è‡ªå®šä¹‰å­—ä½“ -->
<ItemGroup>
  <None Update="Fonts\**\*">
    <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
  </None>
</ItemGroup>
```

## æ€§èƒ½ä¼˜åŒ–é€‰é¡¹

### 1. ReadyToRun (R2R) ç¼–è¯‘
```bash
dotnet publish src/ArmorVehicleDamageAssessment.UI \
  -c Release \
  -r win-x64 \
  --self-contained true \
  -p:PublishReadyToRun=true \
  -o ./publish/win-x64-r2r
```

### 2. ä»£ç è£å‰ªé…ç½®
```xml
<PropertyGroup>
  <PublishTrimmed>true</PublishTrimmed>
  <TrimMode>link</TrimMode>
  <SuppressTrimAnalysisWarnings>false</SuppressTrimAnalysisWarnings>
</PropertyGroup>

<!-- ä¿æŠ¤ä¸åº”è¢«è£å‰ªçš„ç¨‹åºé›† -->
<ItemGroup>
  <TrimmerRootAssembly Include="ArmorVehicleDamageAssessment.UI" />
</ItemGroup>
```

## æ•°å­—ç­¾å (å¯é€‰)

### 1. ä»£ç ç­¾åè¯ä¹¦é…ç½®
```xml
<PropertyGroup>
  <SignAssembly>true</SignAssembly>
  <AssemblyOriginatorKeyFile>key.snk</AssemblyOriginatorKeyFile>
</PropertyGroup>
```

### 2. Authenticodeç­¾å
```bash
# ä½¿ç”¨ signtool (Windows)
signtool sign /f certificate.pfx /p password /t http://timestamp.digicert.com ArmorVehicleDamageAssessment.UI.exe
```

## éƒ¨ç½²éªŒè¯

### 1. ç›®æ ‡æœºå™¨æµ‹è¯•
- [ ] åœ¨çº¯å‡€çš„Windows 10/11ç³»ç»Ÿä¸Šæµ‹è¯•
- [ ] éªŒè¯ä¸éœ€è¦é¢å¤–å®‰è£….NET Runtime
- [ ] æ£€æŸ¥æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] éªŒè¯æ•°æ®åº“æ–‡ä»¶æ­£ç¡®åˆ›å»º

### 2. æ€§èƒ½æµ‹è¯•
- [ ] å¯åŠ¨æ—¶é—´æµ‹è¯•
- [ ] å†…å­˜ä½¿ç”¨æƒ…å†µ
- [ ] æ–‡ä»¶å¤§å°ä¼˜åŒ–

## è‡ªåŠ¨åŒ–CI/CD

### GitHub Actions ç¤ºä¾‹
```yaml
name: Build and Package

on:
  push:
    tags: ['v*']

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '8.0.x'
    
    - name: Publish Windows x64
      run: |
        dotnet publish src/ArmorVehicleDamageAssessment.UI \
          -c Release \
          -r win-x64 \
          --self-contained true \
          -p:PublishSingleFile=true \
          -o ./publish/win-x64
    
    - name: Create Release
      uses: actions/upload-artifact@v3
      with:
        name: ArmorVehicleDamageAssessment-win-x64
        path: ./publish/win-x64/
```

## æ³¨æ„äº‹é¡¹

1. **è·¨å¹³å°é™åˆ¶**: WPFåº”ç”¨ç¨‹åºåªèƒ½åœ¨Windowsä¸Šè¿è¡Œï¼Œå³ä½¿åœ¨Macä¸Šç¼–è¯‘
2. **æµ‹è¯•ç¯å¢ƒ**: å»ºè®®åœ¨Windowsè™šæ‹Ÿæœºä¸­æµ‹è¯•æœ€ç»ˆå‘å¸ƒç‰ˆæœ¬
3. **æ–‡ä»¶è·¯å¾„**: æ³¨æ„Windowså’ŒUnixç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦å·®å¼‚
4. **æƒé™**: å‘å¸ƒçš„åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™è¿è¡Œ
5. **é˜²ç—…æ¯’è½¯ä»¶**: æŸäº›é˜²ç—…æ¯’è½¯ä»¶å¯èƒ½è¯¯æŠ¥è‡ªåŒ…å«çš„.NETåº”ç”¨ç¨‹åº

## å¿«é€Ÿå‘å¸ƒå‘½ä»¤

```bash
# ä¸€é”®å‘å¸ƒå‘½ä»¤ (åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ)
chmod +x scripts/publish.sh && ./scripts/publish.sh

# æˆ–è€…ç›´æ¥ä½¿ç”¨dotnetå‘½ä»¤
dotnet publish src/ArmorVehicleDamageAssessment.UI -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true -o ./dist
```